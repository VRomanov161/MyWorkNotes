# Установка и Настройка NFS сервера и клиента

## На стороне сервера

#### установить необходимые пакеты :
```
$ sudo yum install nfs-utils

```
#### После установки нужных пакетов, нужно запустить службы nfs-server и rpcbind, добавить их в автозагрузку:
```
# systemctl enable rpcbind
# systemctl enable nfs-server
# systemctl start rpcbind
# systemctl start nfs-server

```

###### Если у вас в системе установлен firewalld откройте необходимые порты:

```
# firewall-cmd --permanent --add-port=111/tcp
# firewall-cmd --permanent --add-port=20048/tcp
# firewall-cmd --permanent --zone=public --add-service=nfs
# firewall-cmd --permanent --zone=public --add-service=mountd
# firewall-cmd --permanent --zone=public --add-service=rpc-bind
# firewall-cmd --reload

```

#### Теперь создадим директорию, которая будет раздаваться  NFS сервером:

```
# mkdir -p /nfs
# chmod -R 644 /nfs
```

#### Теперь в конфигурационном файле с настройками NFS сервера (/etc/exports) нужно опубликовать данный каталог и назначить права доступа

```

Добавьте в файл следующую строку для предоставления доступа к NFS всем хостам в указанной IP подсети:

/nfs 192.168.1.0/24(rw,sync,no_root_squash,no_all_squash)

Или можно ограничить доступ для конкретного IP:
/backup/nfs 192.168.2.24(rw,sync,no_root_squash,no_all_squash, anonuid=1000,anongid=1000) 192.168.3.100(ro,async,no_subtree_check)

Сохраянем и закрываем
```
###### Рассмотрим более подробно формат предоставления прав к NFS каталогу:
rw – права на запись в каталоге, ro – доступ только на чтение;
sync – синхронный режим доступа. async – подразумевает, что не нужно ожидать подтверждения записи на диск (повышает производительность NFS, но уменьшает надежность);
no_root_squash – разрешает root пользователю с клиента получать доступ к NFS каталогу (обычно не рекомендуется);
no_all_squash — включение авторизации пользователя. all_squash – доступ к ресурсам от анонимного пользователя;
no_subtree_check – отключить проверку, что пользователь обращается в файлу в определенном каталоге (subtree_check – используется по умолчанию);
anonuid, anongid – сопоставить NFS пользователю/группу указанному локальному пользователю/группе(UID и GID).

#### Чтобы применить новые настройки NFS каталогов, выполните:
```

# exportfs -a
```

#### Презапускаем nfs-сервер:
```

# systemctl restart nfs-server
```

###### На этом установка и настройка nfs-сервера закончена и можно приступить к настройке клиента.

## На стороне клиента:

#### Для настройки NFS клиента, нужно также установить пакет nfs-utils. Для CentOS 7:
```

# yum install nfs-utils
```
#### Добавляем сервисы в автозагрузку и включаем:
```
# systemctl enable rpcbind
# systemctl enable nfs-server
# systemctl start rpcbind
# systemctl start nfs-server
```

#### Теперь на клиенте, нужно создать директорию, в которую мы смонтируем nfs-каталог:
```
# mkdir /nfs
```

#### Теперь можно смонтировать удаленное NFS-хранилище командой:
```

# mount -t nfs 192.168.1.3:/nfs /nfs

Где IP — это адрес NFS-сервера, который вы настроили ранее.
```

#### Чтобы NFS каталог автоматически монтировался при перезагрузке, нужно открыть файл fstab:
```

# vi /etc/fstab

И добавьте строку:

192.168.1.3:/nfs /nfs nfs rw,sync,hard,intr 0 0

После сохранения файла fstab, можно применить его командой:

# mount -a
```
#### Устанвока и настройка сервера и клиента завершена.
