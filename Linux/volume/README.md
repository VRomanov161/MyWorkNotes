# Добавление и монтирование диска

Такая необходимость может возникнуть например при добавлении нового жесткого диска.

#### С помощью команды fdisk необходимо посмотреть какие диски доступны для монтирования:
```

fdisk -l
```

#### Теперь с помощью команды fdisk разобьем диск на разделы :
```

$ sudo  fdisk */путь/к/диску*

*Например*

$ sudo fdisk /dev/sdb

так мы попадаем в меню управления утилиты fdisk

Далее выполните команды в интерфейсе утилиты fdisk

*можно разбить диск на разделы,  если Вы хотите выбрать значение по умолчанию, то нажмите Enter*

Выводим созданные разделы на экран для проверки, с помощью опции p.

Необходимо сохранить внесенные изменения с помощью опции w.
```

#### Теперь на разделах необходимо создать файловую систему с помощью утилиты mkfs, указав после точки тип файловой системы:
```

$ sudo mkfs.ext4 */путь/к/разделу*

*Например*

$ sudo mkfs.ext4 /dev/sdb

*если разделов несколько, то указанные действия необходимо выполнить  для каждого раздела*
```

#### Далее необходимо создать точку монтирования для каждого раздела:
```

$ sudo mkdir */путь/*

*Например*

$ sudo mkdir /mnt
```

#### Для автоматического монтирования разделов после перезагрузки сервера внесите изменения в файл /etc/fstab с помощью текстового редактора:
```
vi /etc/fstab

добавляем строчку

/dev/sdb /mnt ext4 defaults 0 0

Сохраянем и закрываем
```
#### С помощью команды mount монтируем разделы:
```
mount -a
```

# logical volume manager
 *система управления томами с данными для Linux. Она позволяет создавать поверх физических разделов логические тома, которые в самой системе будут видны как обычные блочные устройства с данными (т.е. как обычные разделы)*

 LVM — это дополнительный слой абстракции от железа, позволяющий собрать кучи разнородных дисков в один, и затем снова разбить этот один именно так как нам хочется.

 есть 3 уровня абстракции:
```

 1. PV (Physical Volume) — физические тома (это могут быть разделы или целые «неразбитые» диски)

 2. VG (Volume Group) — группа томов (объединяем физические тома (PV) в группу, создаём единый диск, который будем дальше разбивать так, как нам хочется)

 3. LV (Logical Volume) — логические разделы, собственно раздел нашего нового «единого диска».

 как Группы Томов, который мы потом форматируем и используем как обычный раздел, обычного жёсткого диска.
 ```

 #### Перед использованием диска или раздела в качестве физического тома необходимо его инициализировать:

 ```
 # pvcreate */путь/*- Эта команда создает в начале диска дескриптор группы томов

    # pvs -вывести список физичесиких томов (PV)
    # pvdisplay - вывевести подробную инфомрацию о физических томах (PV)


EXAMPLE

# pvcreate /dev/hdb
```

#### Для создания группы томов (VG) используется команда vgcreate
```
# vgcreate *имя_группы* /dev/hdb

    # vgs - вывести список группы томов

    # vgdisplay - вывевести подробную инфомрацию о  группе томов (VG)
```

#### Для того, чтобы создать логический том (LV) "lv00", размером 1500Мб, в группе томов "vg00" выполните команду:
```

# lvcreate -L1500 -nlv00 vg00

    # lvdisplay - вывевести подробную инфомрацию о логических томах (LV)

    # lvs  вывести список логических томов
```

#### создание файловой системы ext4 для логического тома oracle_app_lv1 в группе томов oracle_app_vg
```

# mkfs.ext4 /dev/oracle_app_vg/oracle_app_lv1

далее монитуем и можно пользоваться
```

#### Для увеличения логического тома вам нужно просто указать команде lvextend до какого размера вы хотите увеличить том:
```

*нижеприведенной командой  /dev/vg00/home увеличится до 12Гбайт :*

# lvextend -L12G /dev/vg00/home


*команда ниже увеличивает размер логического тома на 1Гб :*

 # lvextend -L+1G /dev/vg00/home
```
#### После того как вы увеличили логический том, необходимо соответственно увеличить размер файловой системы:
```
для файловой системы ext2 и выше:

 увеличиваем  файловую систему до конца раздела

# resize2fs /dev/vg00/home

*Если вы не пропатчили ваше ядро патчем ext2online, вам будет необходимо размонтировать файловую систему перед изменением размера:*

# umount /dev/vg00/home
# resize2fs /dev/vg00/home
# mount /dev/vg00/home /home
```

#### Для добавления предварительно инициализированного физического (PV) тома в существующую группу томов используется команда 'vgextend':
```

# vgextend vg00 /dev/hdc1
    старый^^^^   ^^^^^^ новый физический том

```
