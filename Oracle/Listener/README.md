# Listener

Listener определяется в файле listener.ora который по умолчанию находится в папке ORACLE_HOME/network/admin. Как минимум
файл listener.ora должен содержать информацию об одном listener-e, включая имя listener-а, протокол и адресс. Вы можете
настроить несколько listener-ов в одном файле, однако все они должны иметь уникальное имя и адресс.

пример файла listener.ora:
```
LISTENER =
    (DESCRIPTION =
        (ADDRESS = (PROTOCOL = TCP)(HOST = jwlnx1)(PORT = 1521))
    )

LIST2 =
    (DESCRIPTION =
        (ADDRESS_LIST =
            (ADDRESS = (PROTOCOL = TCP)(HOST = 127.0.0.1)(PORT = 1522))
            (ADDRESS = (PROTOCOL = TCP)(HOST = jwlnx1.bplc.co.za)(PORT = 1522))
        )
    )
```

В первой секции описан listener с именем LISTENER, который использует локальное имя хоста на порту по умолчанию, 1521. Во
второй секции определён второй listener с именем LIST2. Он мониторит порт 1522 также на локальном имене хоста и адресе
замыкания (loopback/127.0.0.1).

**Для создания listener-а всё что нужно сделать это добавить запись в файл listener.ora и запустить его выполнив команду
lsnrctl.**

### Статическая регистрация.

Для статической регистрации экземпляра необходимо создать соответствующую запись в файле listener.ora.
```
SID_LIST_LISTENER=
   (SID_LIST=
        (SID_DESC=
          (GLOBAL_DBNAME=valentin)
          (SID_NAME=valentin)
          (ORACLE_HOME=/u01/app/oracle/product/12.2.0/dbhome_1)
```

### Динамическая регистрация.

Этот метод регистрации является предпочтительным, когда экземпляр регистрирует себя у listener-а.

### Методы определения имени.

###### Easy connect

Доступен при использовании только одного протокола: TCP.

connect store/admin123@jwlnxl.bplc.co:1522/ocp11g

В этом примере пользовательский процесс используя TCP протокол подключится к порту 1522 по IP адрессу определённому из
имени хоста. Если listener запущен на этом порту этого сервера – пользовательский процесс запросит listener создать
серверный процесс на instance ocp11g.

###### Local Naming.

Используя эту технику пользователь использует псевдоним (Oracle Net service alias) в строке подключения, а псевдоним
преобразуется в сетевой адресс, протокол, сервис или имя экземпляра с помощью локального файла. Этот файл и есть
tnsnames.ora. Рассмотрим пример файла tnsnames.ora
```

ocp11g =

    (DESCRIPTION =
        (ADDRESS_LIST =
          (ADDRESS = (PROTOCOL = TCP)(HOST = jwlnx1.bplc.co.za)(PORT = 1522))
        )
(CONNECT_DATA =
    (service_name = ocp11g)
)
    )

test =

    (DESCRIPTION =
        (ADDRESS_LIST =
            (ADDRESS = (PROTOCOL = TCP)(HOST = serv2.bplc.co.za)(PORT = 1521))
        )
              (CONNECT_DATA =
                    (sid = testdb)
              )
    )
```

Этот файл содержит два Oracle Net Service alias: ocp11g и test. Эти псевдонимы и есть то, что будут использовать
пользователи в строке подключения. Первый псевдоним ocp11g указывает на то, что если в строке подключения найдено
«@ocp11g», то пользовательский процесс по протоколу TCP, порту 1522 подключится к машине jwlnx1.bplc.co.za и попросит
listener создать сессию для экземпляра с названием сервиса ocp11g. Второй алиас test направит пользовательские процессы по
другому адресу, порту и сессии будут создаваться для экземпляра testdb.

### lsnrctl команды:
```

START запуск listener-а

STOP остановка listener-а

STATUS просмотр состояния listener-а

SERVICES отобразить сервисы доступны listener-у (более детальная информация чем в команде STATUS)

RELOAD перечитать файл ora

SHOW отобразить значения установленных параметров
```

###### Используется три важных файла для настройки Oracle Net:

listener.ora файл на стороне сервера, определяющий listener-ы БД. Влючает в себя сведения о протоколе, адресах и портах,
используемых listener-ом для ожидания запросов на подключения. А также может содержать информацию о статических
зарегистрированных экземплярах БД.

tnsnames.ora – файл со стороны клиента используемый для определения имени. Используется пользовательским процессом для
нахождения listener-ов БД.Также может быть использован самим экземпляром БД для нахождения listener-ов для динамической
регистрации.

sqlnet.ora – файл необязательный, может существовать (и даже с разными значениями) как на клиентской, так и на серверной
стороне. Содержит настройки которые могут применяться ко всем сессиям к listener-ам, такие как настройки безопасности и
шифрования.

Все три файла по умолчанию находятся в папке ORACLE_HOME/network/admin. Можно изменить путь к ним с помощью системной
переменной: TNS_ADMIN. Эта переменная часто используется если сущуствует несколько домашних директорий Oracle. У обычного
сервера Oracle будет как минимум три домашних директории Oracle: одна для Enterprise Manager Grid Control Agent, одна для
запуска экземпляров и одна для запуска экземпляров ASM (Automatic Storage Management).

В Unix и Linux синтаксис может отличаться в зависимости от исползуемой оболочки, но обычно выглядит примерно так
```

set TNS_ADMIN=/u01/oracle/net; export TNS_ADMIN
```
